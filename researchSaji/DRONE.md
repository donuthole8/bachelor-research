# ドローンについての予備知識





## 1. ドローンとは

> ### ドローンについて
>
> - （無人航空機・UAV（Unmanned Aerial Vehicle）とも呼ばれる
>
> - 空撮・災害調査・施設点検・農業分野・公共測量等で活用
>
> - 鳥瞰視点・真横視点での動画が多いが真上視点での撮影も可能
>
> - コース設定での自動操縦可能
>
> - 航空機とは高度の違いにより撮影範囲・解像度が違う
>
> - 大型で300m程、小型で1.7km程の遠隔操作が可能
>
> - 3次元モデルの作成が容易
>
> - 操縦できるようになるまで3～19ヶ月程度
>
> - ドローン・地すべり研究者の内山庄一郎は見ておいた方が良い
>
> 
>
> ### ドローンの種類
>
> - 回転翼型（マルチコプタ型）
>   - 小回りが利き詳細調査が可能
>   - 重量は1kg - 10kg弱
>   - 飛行時間は10分 - 1時間
>
> - 固定翼型
>
>   - 航続距離が長く広範囲を撮影可能
>
>   - 国土地理院は保有していない
>
>     
>
> 
>





## 2. ドローンに関する動向

> - 改正航空法等によって飛行ルール導入
>   - 重要施設等周辺での飛行禁止
> - 国土交通省・首相が建設現場にてドローン導入推進
> - 2020年まで市場規模は右肩上がり
> - 国土地理院によるドローン使用マニュアル作成
> - 国土地理院ランドバード結成
>   - UAV活用のための組織であり災害時の緊急撮影や情報提供を行う
> - 政府が各県の消防局本部にドローン配備





## 3. ドローン活用による災害調査実績

> ### 回転翼型（マルチコプタ型）
>
> - 豪雨・地震・台風被害調査・データ公開
> - 関東・東北豪雨の鬼怒川破堤から4時間後に撮影（国土地理院）
>
> ### 固定翼型
>
> - 火山活動状況調査・データ公開





## 4. 注意すべきこと



> ### ドローン機体
>
> - 周辺の木・上空視界・航空機等
> - 風速・風向等の気象状況
> - 周辺の電磁波
> - 機材の異常
>
> ### 撮影者
>
> - 第三者物件・立ち入り禁止箇所
> - 第三者の立ち入り





## 5. 災害時のドローン活用法

> ### 被災画像・映像の収集
>
> - 動画像からSfMにて地形モデル作成
>   - 被害状況の自動判読
>   - 土砂災害時の土量推定
>
> ### 活用事例
>
> #### 2016年熊本地震
>
> - 市街地付近での初ドローン空撮
> - 目視により屋根、壁、基礎の被害割合をみる罹災度判定調査が迅速化を妨げる要因ですが、屋根被害については、ドローン撮影画像をもとに、外部からの支援を受けながら判定
>
> #### 三次元モデル生成
>
> - 様々な角度から建物を撮影しモデル作成ソフトに入力することで作成
> - 建物・地形の高さ・形状を簡単に短時間で把握
>   - 地震応答解析に利用
>
> #### その他
>
> ### 期待されてること
>
> - 遠隔操作でのカメラやレーザ距離計等によって土砂を採取する装置にて情報収集
> - 火山噴火時の土石流で空撮とか
> - 





## 6. 研究アイデアメモ

> - ドローン遠くまで飛ばす、データ拾ってくる、オルソ化、一気に検出処理
>
> - オルソ化無しだとフレーム毎に領域分割しなければならない
>
> - まあヘリでもできるか．．．





## 竹内さんメモ

```
# 画像情報処理論 191112 

* ドローン映像処理とその応用
* 招待講演 豊橋技術科学大学 金澤さん
* kanazawa@tut.jp
* kanazawa@cs.tut.ac.jp

## コンピュータビジョン

* 人間の視覚認識の機能を計算機上に表現する

## 研究

* 画像処理
  * 視覚多様性
  * 交通弱者
* 物体検出・認識
  * 砂浜における漂着物検出
  * 自動追尾スポットライトのための新郎新婦検出
* 3次元復元
  * 平面状形状の高精度復元
* 農業応用
  * 可視カメラ画像からの不可視バンド画像の推定
  * ドローン映像からの変色キャベツの検出
* MR応用
  * バーチャルノマドワークシステム

## ドローン

* 遠隔操縦または自律式の無人航空機
  * 撮影、競技、農業、宅配、軍事、測量、
  * 橋梁点検、写真測量、運搬、救助、水中
* 200g以上のものは規制がある

### 利点

* 制限内であれば場所時間を選ばない
* 搭載機器を選べる

### 欠点

* 飛行時間が短い(10分～30分)
* 雨や風が強いときは飛ばせない
* 各種機器を揃えるとコストが高い

### 飛行情報共有システム

* Flight Information Sharing System

### ドローン映像からの三次元復元

* 映像から港の映像の復元 28?
* 東日本大震災
  * 閖上浜の行方不明者の捜索
  * 地中レーダーを利用
    * 自律移動させたい
  * 表層調査の自動化
  * 三次元復元＋貼り合わせ

### 復元処理の流れ

* 画像間の対応付け
  * 校正されていない場合は2次元的に探索をする必要がある
* 基礎行列計算
  * 校正済みの場合不要
* カメラパラメータ計算
  * 校正済みの場合不要
* 三角測量
* 相似復元->校正済みの場合は復元となる
  * スケールが一意に決定できない
* バンドル調整

### 画像間の対応付け

* Bag of featureなどがあるが...
* 幾何学的に意味のある場所で
* 厳密には同じ物体の同じ個所を探したい
* 誤対応を減らしたい
  * カメラパラメータ自体もおかしくなる
  * RANSAC
    * 画像間の仮の対応を求める
    * 対応集合からランダムに8組の対応を選び、基礎行列を計算
    * 計算した基礎行列によるエピ曲線拘束条件を満足する対応を求める
    * 2~3を十分な回数繰り返し、最も対応の多い基礎行列とその対応を返す
* カメラ間の撮影条件を利用できる
* もし一部の情報が既知なら積極的に利用可能
* まったくわからなくても利用可能
* 構成済みの場合エピポーラ線上を探索すればよいため1次元

### 三角測量

* 山の高さを測る
  * 地上2点の角度と2点間の距離から山の高さを測れる
* 2画像からの復元->ステレオ
  * 2台のカメラの相対的な位置関係
  * 画像中のマッチング点
  * 2台のカメラの焦点距離
* 校正済みの場合
  * カメラの位置関係が既知
  * 各カメラの内部パラメータが既知
    * 不定性のない復元が可能
* 未校正の場合
  * 一部の情報が未確定(大きさなど)
  * 画像以外すべて未知

### 2台以上のカメラがある場合

* 因子分解法
* 線形な投影を仮定
  * 結構ロバスト
* SfMの最初の技術
* 計算は安定・復元形状に歪み
  * 線形投影の影響
* すべての特徴点がすべてのフレームにおいて観測される必要がある

### バンドル調整

* 再投影誤差を最小化することで物体の形状とカメラの位置や焦点距離を同時に推定する手法
* 再投影誤差
  * 仮定したカメラで撮影した位置と観測された位置とのずれ
  * 高精度な復元が可能
  * もともとは写真測量における技術

### 平面情報を利用した高精度かつリアルタイムな形状復元

* シーン内の平面情報を利用
  * シーン内の平面に対する射影変換行列を使用
  * 射影変換行列は平面であるという強い拘束情報をもつ
* 平面以外の部分はパララックス情報を利用
  * 平面上にない点は射影変換行列を使うとズレ(パララックス)る
  * ずれは平面からの高さに関係する

1. 入力フレーム
-- ドローン映像に特化したフレーム選択 --
2. フロー計算
3. キーフレーム選択判定
4. 特徴点検出
--
5. キーフレーム・対応点

### ループクロージングの利用

* 以前のカメラ位置に近い場所に戻ったことを利用
  * ループクロージング
* ドローンによる撮影であ局所的にループクロージングが発生
* 共通する点を結んだCovisivility Graphを利用

### ドローンからの三次元復元の用途

* 土地・建物の測量
  * Smart construcution
  * i-Construction

### 浜北大橋の例

* モザイクによるオルソ貼り合わせ
  * 橋が曲がってしまう
* 3次元復元なら曲がらない
  * しかし凹型に反ってしまう
* 木が斜めになってしまう
  * 色々な方向から撮影しないとそうなる
* 先生独自のソフト
  * 平面で束縛する
  * ずれないが橋の部分が誤差になって出てきてしまう

## ドローンによる農業応用

* 精密農業(IT農業)とは
  * 農地や農作物の状況をよく観察する
  * その状況に応じてきめ細かく制御する
  * その成果に基づいて次年度の計画を立てる
* 支援ツールが存在
  * 観察・制御・収穫・解析
  * IT・IoT・ドローンなど
* 可視化->センシング->ケア->結果->可視化...

## 農場と画像処理

* 圃場あるいは複数圃場間のセンシング
  * 人工衛星など大まかな分析
  * リモートセンシング
* 収穫物のセンシング
  * マシンビジョン
  * ドローン・自律移動ロボット

* ドローンを使うメリット
  * 安価・高解像度・手軽
  * 搭載センサを選択可能

### マルチスペクトルカメラ

* 可視光以外の複数の色を撮影できる
  * G,R,Red Edge(720nm前後), NIR(840nm前後)
* NIRを利用したものにNDVIなど
* Red Edgeを利用したものにNDRE
  * 葉の重なりの検出

### 可視カメラ画像からの不可視画像の推定

* 衛星画像は購入しなければ使えない
* マルチスペクトルカメラ付きドローンは高い(百万～)
  * 機械学習・深層学習を用いる
    * 機械学習
      * 土地分類マップ(植生/それ以外)を元に、教師データを用いて各画素ごとに以下の回帰関数を求める
      * 得られた回帰関数を使ってRGB画像を変換してNIR/Red edge画像を求める
    * 深層学習
      * pix2pix(GAN)を用い、RGB画像からNIR画像とRed edge画像を直接学習する
    * 画像内の各ピクセルから植生とその他の2カテゴリに分類する決定木を学習

### 三次元復元を用いた?LAI指数

* Leaf Area Index
  * ある土地に存在する植物のすべての葉の片側の面積の合計を単位土地面積あたりの値へ換算したもの
  * 光合成能力の高さを示す
  * 植物ごとに最適値が決まっている

* 直接法
  * 全部の葉を刈り取って計算
* 間接法
  * 画像を使って計測
    * 魚眼レンズや近赤外カメラ

* カメラ付きドローンを用いる

### 不良キャベツの選別

* キャベツの分類が難しい
  * 分離しないといけない・成長度によって変わる

### ドローンの環境調査

* UAVと農業用マルチスペクトルカメラによる伊豆沼の植生分類の研究
  * 宮城県北部の自然湖沼
  * 水門改修後排水の流入による富栄養化
  * ハスの繁殖
* ドローンによるリモートセンシング
  * 植物種によりスペクトルの特徴が異なる
  * 分光光度計で調べた
  * 領域分割
    * superpixelを利用

## 質疑応答

* 数値計算と機械学習で破綻を防ぐ
* CNN-SLAM

## 質問したいこと

* 未校正は内部パラメータも含まれるか
  * 実際どの程度誤差があるのか

* 焦点距離情報はあるに越したことはない
  * 内部パラメータはバンドル調整でどうにかなる
  * 研究では実際にキャリブレーションを行っている
  * ヘリテレに適応したい
  * 斜め下を向いている・直進するような画像に適用できるか
* Red Edge / NDVIなどのPix2Pix
  * どれくらい学習したのか
* 圃場の復元
  * 風が強いと難しそう
```